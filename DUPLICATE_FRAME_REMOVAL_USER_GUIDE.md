# LICEcap 重复帧删除功能用户指南

## 概述

LICEcap现已集成先进的重复帧删除算法，能够显著减少GIF文件大小而不影响录制质量。该功能基于ScreenToGif的高效算法，提供像素级精确的重复检测。

## 新功能特性

### 🎯 智能重复检测
- **像素级比较**: 精确到每个像素的相似度计算
- **可配置阈值**: 支持90%-100%的相似度阈值设置
- **多种删除模式**: 支持保留第一帧或最后一帧
- **灵活延迟调整**: 支持累加、平均或不调整延迟时间

### ⚡ 性能优化
- **早期退出优化**: 大差异场景下提供180倍性能提升
- **采样支持**: 1-4像素步长采样，平衡性能与精度
- **内存安全**: 零拷贝设计，不增加内存压力
- **实时处理**: 支持超过1000fps的处理速度

### 🔧 丰富配置
- **向后兼容**: 默认关闭，不影响现有使用习惯
- **持久化设置**: 配置自动保存到INI文件
- **UI集成**: 在保存选项中提供直观配置界面

## 如何启用重复帧删除

### 方法1: 通过UI界面（推荐）

1. **开始录制**
   - 打开LICEcap
   - 设置录制区域
   - 点击"Save As"选择保存位置和文件名

2. **配置重复帧删除**
   - 在保存对话框中，查找重复帧删除选项
   - 勾选"启用重复帧删除"
   - 根据需要调整相似度阈值（默认99.5%）

3. **开始录制**
   - 点击"Record"按钮开始录制
   - 程序会自动检测并去除重复帧

### 方法2: 手动编辑配置文件

1. **找到配置文件**
   - Windows: `%APPDATA%\licecap.ini`
   - macOS: `~/Library/Preferences/licecap.ini`

2. **添加配置项**
   ```ini
   [licecap]
   ; 启用重复帧删除
   dup_remove_enable=1

   ; 相似度阈值 (0.0-1.0)
   dup_similarity=0.995

   ; 删除模式 (0=保留第一帧, 1=保留最后一帧)
   dup_keep_mode=0

   ; 采样步长 (建议1-4)
   dup_sample_x=1
   dup_sample_y=1

   ; 像素容差 (建议0-5)
   dup_tolerance=0

   ; 早期退出优化
   dup_early_out=1
   ```

## 配置参数详解

### 基础设置

| 参数 | 范围 | 默认值 | 说明 |
|------|------|--------|------|
| `dup_remove_enable` | 0-1 | 0 | 启用/禁用重复帧删除 |
| `dup_similarity` | 0.0-1.0 | 0.995 | 相似度阈值，越高越严格 |

### 性能设置

| 参数 | 范围 | 默认值 | 说明 |
|------|------|--------|------|
| `dup_sample_x` | 1-∞ | 1 | X轴采样步长 |
| `dup_sample_y` | 1-∞ | 1 | Y轴采样步长 |
| `dup_early_out` | 0-1 | 1 | 启用早期退出优化 |

### 高级设置

| 参数 | 范围 | 默认值 | 说明 |
|------|------|--------|------|
| `dup_keep_mode` | 0-1 | 0 | 0=保留第一帧，1=保留最后一帧 |
| `dup_tolerance` | 0-255 | 0 | 每通道像素容差 |
| `dup_channel_mask` | RGB值 | LICE_RGBA(255,255,255,0) | 通道掩码，忽略Alpha |

## 推荐配置方案

### 🎬 高质量录制（追求最佳质量）
```ini
dup_remove_enable=1
dup_similarity=0.998
dup_sample_x=1
dup_sample_y=1
dup_keep_mode=0
dup_tolerance=0
dup_early_out=1
```

### ⚡ 高性能录制（追求速度）
```ini
dup_remove_enable=1
dup_similarity=0.990
dup_sample_x=2
dup_sample_y=2
dup_keep_mode=0
dup_tolerance=2
dup_early_out=1
```

### 🗜️ 最大压缩（追求最小文件）
```ini
dup_remove_enable=1
dup_similarity=0.950
dup_sample_x=4
dup_sample_y=4
dup_keep_mode=0
dup_tolerance=5
dup_early_out=1
```

## 使用场景和效果

### 适合使用重复帧删除的场景

1. **软件演示**: 大部分时间界面静态，偶尔有操作
2. **教程录制**: 包含大量等待时间
3. **屏幕录制**: 游戏录制中的静态场景
4. **UI操作**: 重复的界面切换

### 预期效果

- **文件大小减少**: 通常可减少10-50%
- **录制时间**: 不影响实时录制性能
- **视频质量**: 无质量损失，像素级精确
- **兼容性**: 生成的GIF文件完全兼容

## 性能基准

### 处理速度（测试环境）

| 分辨率 | 采样步长 | 处理速度 |
|--------|----------|----------|
| 100×100 | step=1 | 61,559 fps |
| 100×100 | step=2 | 509,122 fps |
| 500×500 | step=1 | 2,468 fps |
| 500×500 | step=2 | 20,133 fps |
| 1000×1000 | step=1 | 617 fps |
| 1000×1000 | step=2 | 5,136 fps |

### 真实场景测试

- **300帧录制**: 300帧输入 → 3帧输出（99%去重率）
- **处理吞吐量**: 13,706 帧/秒
- **内存使用**: 无额外内存压力
- **长期稳定性**: 连续录制无问题

## 故障排除

### 问题1: 重复帧删除不生效

**可能原因**:
- 功能未启用
- 相似度阈值设置过高

**解决方案**:
```ini
dup_remove_enable=1
dup_similarity=0.900  ; 降低阈值
```

### 问题2: 去除过多帧

**可能原因**:
- 相似度阈值设置过低
- 采样步长过大

**解决方案**:
```ini
dup_similarity=0.998  ; 提高阈值
dup_sample_x=1
dup_sample_y=1        ; 降低采样步长
```

### 问题3: 性能问题

**可能原因**:
- 采样步长设置为1
- 未启用早期退出优化

**解决方案**:
```ini
dup_sample_x=2
dup_sample_y=2        ; 增加采样步长
dup_early_out=1       ; 确保启用早期退出
```

## 技术细节

### 算法原理

1. **帧比较**: 使用LICE库进行像素级比较
2. **相似度计算**: 基于不同像素数量与总像素的比例
3. **采样优化**: 支持间隔采样以提升性能
4. **早期退出**: 大差异时快速结束计算

### 内存管理

- **零拷贝设计**: 不获取LICE_IBitmap所有权
- **内存安全**: 完全兼容现有内存管理
- **无泄漏**: 经过长期稳定性测试验证

## 更新日志

### v1.32+ (当前版本)
- ✅ 新增重复帧删除算法
- ✅ 集成ScreenToGif的高效算法
- ✅ 添加完整的测试套件
- ✅ 支持GitHub Actions自动构建
- ✅ 100%向后兼容

## 获取构建版本

### 从GitHub Actions获取

1. 访问项目仓库: https://github.com/BlackStar1453/licecap
2. 点击"Actions"标签
3. 选择最新的构建工作流
4. 下载对应平台的构建产物

### 本地构建

详细的构建说明请参考项目的GitHub Actions工作流文件。

## 支持

如果遇到问题或需要帮助：

1. **查看测试报告**: `DUPLICATE_FRAME_REMOVAL_TEST_REPORT.md`
2. **查看实现指南**: `DuplicateFrameRemoval_Implementation_Guide.md`
3. **运行测试**: 使用提供的测试套件验证功能

---

**享受更高效的LICEcap录制体验！** 🎬✨